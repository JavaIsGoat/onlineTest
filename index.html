<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple Testing Application</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f2f5;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .screen {
        display: none;
        width: 80%;
        max-width: 800px;
        background: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .active {
        display: block;
      }

      h1,
      h2 {
        text-align: center;
        color: #333;
      }

      p {
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      button {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        font-size: 16px;
        background-color: #007bff;
        border: none;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: #0056b3;
      }

      #editor {
        width: 100%;
        height: 300px;
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical;
        margin-bottom: 20px;
      }

      #log {
        margin-top: 20px;
        max-height: 200px;
        overflow-y: auto;
        background: #f9f9f9;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        white-space: pre-wrap;
      }

      .log-entry {
        margin-bottom: 5px;
      }

      .sus {
        color: red;
      }

      /* Responsive Design */
      @media (max-width: 600px) {
        .screen {
          width: 95%;
          padding: 20px;
        }

        #editor {
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Start Screen -->
    <div id="start-screen" class="screen active">
      <h1>Welcome to an Online Test</h1>
      <p>
        This is a closed-book test with <b>in-person proctoring</b>. This
        application can track your <b>copy, cut, and paste</b> actions, as well
        as detect when you <b>switch tabs or change the browser window</b>.
      </p>
      <p>
        There are invigilators in this classroom to make sure students do not
        communicate with each other. Reference documents and phones are not
        permitted.
      </p>
      <button id="start-button">Start</button>
    </div>

    <!-- Editor Screen -->
    <div id="editor-screen" class="screen">
      <h2>Q: Create a for loop with Python</h2>
      <textarea id="editor" placeholder="Start typing here..."></textarea>

      <div id="log">
        <strong>Activity Log:</strong>
      </div>

      <button id="submit-button">Submit</button>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="screen">
      <h1>Submission Received</h1>
      <p>
        Your content and activity log has been successfully submitted. Below is
        what you submitted:
      </p>
      <div
        id="submitted-content"
        style="
          white-space: pre-wrap;
          background: #f9f9f9;
          padding: 15px;
          border: 1px solid #ddd;
          border-radius: 4px;
          margin-top: 20px;
        "
      ></div>
      <button id="restart-button">Restart</button>
    </div>

    <script>
      // Get references to screens
      const startScreen = document.getElementById("start-screen");
      const editorScreen = document.getElementById("editor-screen");
      const endScreen = document.getElementById("end-screen");

      // Get references to buttons
      const startButton = document.getElementById("start-button");
      const submitButton = document.getElementById("submit-button");
      const restartButton = document.getElementById("restart-button");

      // Get references to editor and log
      const editor = document.getElementById("editor");
      const log = document.getElementById("log");
      const submittedContent = document.getElementById("submitted-content");

      let submittedText = "";

      // Function to switch screens
      function showScreen(screen) {
        startScreen.classList.remove("active");
        editorScreen.classList.remove("active");
        endScreen.classList.remove("active");

        screen.classList.add("active");
      }

      // Start button event
      startButton.addEventListener("click", () => {
        showScreen(editorScreen);
      });

      // Restart button event
      restartButton.addEventListener("click", () => {
        // Reset editor and log
        editor.value = "";
        log.innerHTML = "<strong>Event Log:</strong>";
        submittedContent.textContent = "";
        showScreen(startScreen);
      });

      // Submit button event
      submitButton.addEventListener("click", () => {
        submittedText = editor.value.trim();
        if (submittedText === "") {
          alert("Cannot submit empty content.");
          return;
        }
        submittedContent.textContent = submittedText;
        showScreen(endScreen);
      });

      // Function to add entries to the log
      function addLog(message, sus) {
        const entry = document.createElement("div");
        entry.className = "log-entry";
        if (sus) entry.className = "log-entry sus";
        const timestamp = new Date().toLocaleTimeString();
        entry.textContent = `[${timestamp}] ${message}`;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight; // Auto-scroll to the bottom
      }

      // Copy-Paste Detection
      editor.addEventListener("copy", () => {
        addLog("Content cut or copied.", true);
      });

      editor.addEventListener("cut", () => {
        addLog("Content cut or copied.", true);
      });

      editor.addEventListener("paste", () => {
        addLog("Content pasted.", true);
      });

      // Tab/Window Change Detection using Page Visibility API
      let hidden, visibilityChange;
      if (typeof document.hidden !== "undefined") {
        // Standard
        hidden = "hidden";
        visibilityChange = "visibilitychange";
      } else if (typeof document.msHidden !== "undefined") {
        // IE
        hidden = "msHidden";
        visibilityChange = "msvisibilitychange";
      } else if (typeof document.webkitHidden !== "undefined") {
        // WebKit
        hidden = "webkitHidden";
        visibilityChange = "webkitvisibilitychange";
      }

      if (
        typeof document.addEventListener !== "undefined" &&
        typeof hidden !== "undefined"
      ) {
        document.addEventListener(
          visibilityChange,
          () => {
            if (document[hidden]) {
              addLog("Tab or window lost focus.", true);
            } else {
              addLog("Tab or window gained focus.", true);
            }
          },
          false
        );
      } else {
        addLog(
          "The Page Visibility API is not supported by this browser.",
          true
        );
      }

      // Optional: Detecting focus and blur events on the editor
      editor.addEventListener("focus", () => {
        addLog("Editor focused.", false);
      });

      editor.addEventListener("blur", () => {
        addLog("Editor lost focus.", false);
      });

      // Inform the user about unsupported screenshot detection
      //   addLog(
      //     "Note: Screenshot detection is not supported due to browser security restrictions."
      //   );
    </script>
  </body>
</html>
